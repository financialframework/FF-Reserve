<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FF Reserve · The Bucket Method</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020817;
      --bg-soft: #030b17;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.12);
      --danger: #fb923c;
      --radius: 18px;
      --font: system-ui, -apple-system, BlinkMacSystemFont, -sans-serif;
      --border-subtle: rgba(148,163,253,0.15);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.03), transparent 55%),
        radial-gradient(circle at bottom, rgba(15,23,42,1), #020817 70%);
      font-family: var(--font);
      color: var(--fg);
    }
    .shell {
      width: 100%;
      max-width: 420px;
      padding: 20px 16px 24px;
    }
    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 16px;
    }
    .brand-title {
      font-size: 1.05rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .brand-name {
      font-size: 1.6rem;
      font-weight: 500;
    }
    .brand-name span {
      color: var(--accent);
      font-weight: 600;
    }
    .brand-sub {
      font-size: 0.78rem;
      color: var(--muted);
    }
    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.04), transparent),
                  var(--bg-soft);
      border-radius: var(--radius);
      padding: 16px 14px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 55px rgba(15,23,42,0.9);
    }
    h2 {
      margin: 0 0 6px;
      font-size: 1.05rem;
      font-weight: 500;
    }
    p {
      margin: 0 0 8px;
      font-size: 0.8rem;
      color: var(--muted);
    }
    .input-group {
      margin-bottom: 8px;
    }
    label {
      display: block;
      font-size: 0.72rem;
      color: var(--muted);
      margin-bottom: 2px;
    }
    input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,253,0.18);
      background: #020817;
      color: var(--fg);
      font-size: 0.8rem;
      outline: none;
    }
    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.25);
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 7px 11px;
      font-size: 0.78rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: var(--accent);
      color: #020817;
      margin-top: 4px;
    }
    button.secondary {
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(148,163,253,0.24);
    }
    button.link {
      background: transparent;
      border: none;
      color: var(--accent);
      padding: 0;
      margin: 0;
    }
    button.danger {
      background: transparent;
      color: var(--danger);
      border: 1px solid rgba(248,180,116,0.4);
    }
    button:disabled {
      opacity: 0.45;
      cursor: default;
    }
    .footer-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }
    .status {
      margin-top: 4px;
      font-size: 0.72rem;
      min-height: 0.9em;
      color: var(--muted);
    }
    .status.ok { color: #22c55e; }
    .status.err { color: var(--danger); }
    .hint {
      font-size: 0.68rem;
      color: var(--muted);
      margin-top: 4px;
      line-height: 1.3;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 6px;
    }
    .pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.18);
      font-size: 0.65rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #020817;
    }
    .pill strong {
      color: var(--accent);
      font-weight: 500;
    }
    [data-view] { display: none; }
    [data-view].active { display: block; }
    pre {
      margin: 4px 0 0;
      padding: 6px;
      border-radius: 8px;
      background: #020817;
      border: 1px solid rgba(148,163,253,0.14);
      font-size: 0.68rem;
      color: var(--muted);
      max-height: 140px;
      overflow: auto;
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="brand">
    <div class="brand-title">Financial Framework</div>
    <div class="brand-name">FF <span>Reserve</span></div>
    <div class="brand-sub">Powered by the Bucket Method · Needs · Wants · Success</div>
  </div>

  <div class="card">
    <!-- VIEW: WELCOME -->
    <section data-view="welcome" class="active">
      <h2>Welcome</h2>
      <p>Start by creating your account, then verify your contact info, then sign in to your FF Reserve dashboard.</p>
      <div class="pill-row">
        <div class="pill"><strong>Secure</strong> verified email & phone</div>
        <div class="pill"><strong>Simple</strong> 3-step onboarding</div>
        <div class="pill"><strong>Bucket</strong> Needs · Wants · Success</div>
      </div>
      <div class="footer-actions">
        <button id="goSignup">Create account</button>
        <button id="goLoginFromWelcome" class="secondary">Already have an account</button>
      </div>
      <div class="status" id="welcomeStatus"></div>
    </section>

    <!-- VIEW: SIGNUP -->
    <section data-view="signup">
      <h2>Create your FF Reserve account</h2>
      <p>We verify both email and phone to keep your budget data locked to you.</p>
      <div class="input-group">
        <label>Name</label>
        <input id="su_name" autocomplete="name" />
      </div>
      <div class="input-group">
        <label>Email</label>
        <input id="su_email" autocomplete="email" />
      </div>
      <div class="input-group">
        <label>Mobile phone</label>
        <input id="su_phone" placeholder="+15555550123" />
      </div>
      <div class="input-group">
        <label>Password</label>
        <input id="su_password" type="password" />
      </div>
      <div class="input-group">
        <label>Language</label>
        <input id="su_locale" value="en" />
      </div>
      <div class="input-group">
        <label>Theme</label>
        <input id="su_theme" value="system" />
      </div>
      <button id="signupBtn">Sign up</button>
      <div class="footer-actions">
        <button id="backFromSignup" class="secondary">Back</button>
      </div>
      <div id="signupStatus" class="status"></div>
      <div class="hint">
        After signup, we’ll log mock codes in the backend console in this V1. In production these are sent by email and SMS.
      </div>
    </section>

    <!-- VIEW: VERIFY -->
    <section data-view="verify">
      <h2>Verify your contact info</h2>
      <p>Enter the codes you received (or see logged in the console in this demo build).</p>
      <div class="input-group">
        <label>User ID</label>
        <input id="v_userId" />
      </div>
      <div class="input-group">
        <label>Email code</label>
        <input id="v_emailCode" placeholder="6-digit" />
      </div>
      <div class="input-group">
        <label>Phone code</label>
        <input id="v_phoneCode" placeholder="6-digit" />
      </div>
      <button id="verifyEmailBtn" class="secondary">Verify email</button>
      <button id="verifyPhoneBtn" class="secondary">Verify phone</button>
      <div class="footer-actions">
        <button id="verifyDoneBtn">I’ve verified both</button>
        <button id="backFromVerify" class="secondary">Back</button>
      </div>
      <div id="verifyStatus" class="status"></div>
      <div class="hint">
        Once both are verified, your account is activated. You can then log in from the next screen.
      </div>
    </section>

    <!-- VIEW: LOGIN -->
    <section data-view="login">
      <h2>Sign in to FF Reserve</h2>
      <p>Use your verified email and password.</p>
      <div class="input-group">
        <label>Email</label>
        <input id="li_email" autocomplete="email" />
      </div>
      <div class="input-group">
        <label>Password</label>
        <input id="li_password" type="password" />
      </div>
      <button id="loginBtn">Sign in</button>
      <div class="footer-actions">
        <button id="backFromLogin" class="secondary">Back</button>
        <button id="goSignupFromLogin" class="secondary">Create account</button>
      </div>
      <div id="loginStatus" class="status"></div>
    </section>

    <!-- VIEW: DASHBOARD -->
    <section data-view="dashboard">
      <h2>Your FF Reserve</h2>
      <p>Below is live data from <code>/me</code>. Next step is layering in incomes, fixed costs, and your Bucket Method targets.</p>
      <div id="meBox"><span class="hint">Loading profile...</span></div>
      <div class="hint">
        When we add the full budgeting engine, this screen becomes:
        Needs vs Wants vs Success, upcoming bills, reminders, and suggestions to lower Needs if they creep above 35%.
      </div>
      <div class="footer-actions">
        <button id="logoutBtn" class="secondary">Logout</button>
        <button id="deleteBtn" class="danger">Delete account</button>
      </div>
      <div id="dashStatus" class="status"></div>
    </section>
  </div>
</div>

<script>
  const apiBase = ""; // same origin

  function $(id) {
    return document.getElementById(id);
  }

  function setView(name) {
    document.querySelectorAll("[data-view]").forEach(s => {
      s.classList.toggle("active", s.getAttribute("data-view") === name);
    });
    // Clear status messages when switching views
    ["welcomeStatus","signupStatus","verifyStatus","loginStatus","dashStatus"].forEach(id => {
      const el = $(id);
      if (el) { el.textContent = ""; el.className = "status"; }
    });
    if (name === "dashboard") {
      loadMe();
    }
  }

  function setStatus(id, msg, ok) {
    const el = $(id);
    if (!el) return;
    el.textContent = msg || "";
    el.className = "status " + (msg ? (ok ? "ok" : "err") : "");
  }

  async function api(path, options = {}) {
    const res = await fetch(apiBase + path, {
      credentials: "include",
      headers: { "Content-Type": "application/json" },
      ...options
    });
    let data = null;
    try { data = await res.json(); } catch {}
    if (!res.ok) {
      throw new Error((data && data.error) || ("HTTP " + res.status));
    }
    return data;
  }

  // Nav button wiring
  $("goSignup").onclick = () => setView("signup");
  $("goLoginFromWelcome").onclick = () => setView("login");
  $("backFromSignup").onclick = () => setView("welcome");
  $("backFromVerify").onclick = () => setView("signup");
  $("backFromLogin").onclick = () => setView("welcome");
  $("goSignupFromLogin").onclick = () => setView("signup");

  $("verifyDoneBtn").onclick = () => {
    setView("login");
    setStatus("loginStatus", "If both codes were correct, you can now sign in.", true);
  };

  // Signup
  $("signupBtn").onclick = async () => {
    setStatus("signupStatus", "Creating account...", true);
    try {
      const body = {
        name: $("su_name").value.trim(),
        email: $("su_email").value.trim(),
        phone: $("su_phone").value.trim(),
        password: $("su_password").value,
        locale: $("su_locale").value.trim() || "en",
        theme: $("su_theme").value.trim() || "system"
      };
      if (!body.name || !body.email || !body.phone || !body.password) {
        setStatus("signupStatus", "All fields are required.", false);
        return;
      }
      const data = await api("/auth/signup", {
        method: "POST",
        body: JSON.stringify(body)
      });
      if (data.userId) {
        $("v_userId").value = data.userId;
        setStatus("signupStatus", "Account created. Codes logged in backend console in this demo.", true);
        setView("verify");
      } else {
        setStatus("signupStatus", "Missing userId in response.", false);
      }
    } catch (e) {
      setStatus("signupStatus", e.message, false);
    }
  };

  // Verify email / phone
  $("verifyEmailBtn").onclick = async () => {
    const userId = $("v_userId").value.trim();
    const code = $("v_emailCode").value.trim();
    if (!userId || !code) {
      setStatus("verifyStatus", "User ID and email code required.", false);
      return;
    }
    try {
      await api("/auth/verify-email", {
        method: "POST",
        body: JSON.stringify({ userId, code })
      });
      setStatus("verifyStatus", "Email verified.", true);
    } catch (e) {
      setStatus("verifyStatus", "Email verify failed: " + e.message, false);
    }
  };

  $("verifyPhoneBtn").onclick = async () => {
    const userId = $("v_userId").value.trim();
    const code = $("v_phoneCode").value.trim();
    if (!userId || !code) {
      setStatus("verifyStatus", "User ID and phone code required.", false);
      return;
    }
    try {
      await api("/auth/verify-phone", {
        method: "POST",
        body: JSON.stringify({ userId, code })
      });
      setStatus("verifyStatus", "Phone verified. If both are verified, account is active.", true);
    } catch (e) {
      setStatus("verifyStatus", "Phone verify failed: " + e.message, false);
    }
  };

  // Login
  $("loginBtn").onclick = async () => {
    const email = $("li_email").value.trim();
    const password = $("li_password").value;
    if (!email || !password) {
      setStatus("loginStatus", "Email and password required.", false);
      return;
    }
    try {
      await api("/auth/login", {
        method: "POST",
        body: JSON.stringify({ email, password })
      });
      setStatus("loginStatus", "Login successful.", true);
      setView("dashboard");
    } catch (e) {
      setStatus("loginStatus", "Login failed: " + e.message, false);
    }
  };

  // Load /me into dashboard
  async function loadMe() {
    try {
      const data = await api("/me");
      const box = $("meBox");
      box.innerHTML = "";
      const pre = document.createElement("pre");
      pre.textContent = JSON.stringify(data, null, 2);
      box.appendChild(pre);
      setStatus("dashStatus", "Session active.", true);
    } catch (e) {
      $("meBox").innerHTML = "<span class='hint'>Not logged in or session expired.</span>";
      setStatus("dashStatus", "No active session.", false);
    }
  }

  // Logout
  $("logoutBtn").onclick = async () => {
    try {
      await api("/auth/logout", { method: "POST" });
      setStatus("dashStatus", "Logged out.", true);
      $("meBox").innerHTML = "<span class='hint'>Not logged in.</span>";
      setView("welcome");
    } catch (e) {
      setStatus("dashStatus", "Logout failed: " + e.message, false);
    }
  };

  // Delete account
  $("deleteBtn").onclick = async () => {
    if (!confirm("Delete your FF Reserve account? This cannot be undone.")) return;
    try {
      await api("/account", { method: "DELETE" });
      setStatus("dashStatus", "Account deleted.", true);
      $("meBox").innerHTML = "<span class='hint'>Account deleted.</span>";
      setView("welcome");
    } catch (e) {
      setStatus("dashStatus", "Delete failed: " + e.message, false);
    }
  };
</script>
</body>
</html>
